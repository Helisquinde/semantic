#!/bin/bash

chmod a+x *.py

read -r -p "Install sudo packages to your dev system? [Y/N] " response
case $response in
    [yY][eE][sS]|[yY])
		#Put sudo packages that install to the development machine here. There should be no npm or pip here, because that is installed to the virtual environment below.
		sudo apt-get install python-virtualenv
		sudo apt-get install xvfb
        ;;
    *)
        echo "Not installing sudo packages."
        ;;
esac

if ! find venv/bin/pip | read v; then
	echo Setting up Virtual Environment
	virtualenv --no-site-packages venv &> /dev/null
	venv/bin/pip install --upgrade pip
	venv/bin/pip install -r venv/requirements.txt
	cd venv
	source bin/activate

	npm install gulp
    npm install gulp-coffee
    npm install gutil
    npm install gulp-uglify
    npm install gulp-rename
    npm install gulp-less
    npm install gulp-minify-css
    npm install gulp-concat
    #install nodejs
	easy_install nose
	easy_install jasmine
	deactivate
	cd ..
fi

mkdir db &> /dev/null
if ! find db/bigdata-bundled.jar | read v; then
	
	if find ../db/bigdata-bundled.jar | read v; 
	then
		echo Copying Blazegraph jar file...
		cp ../db/bigdata-bundled.jar db/bigdata-bundled.jar
	else
		echo Downloading Blazegraph jar file...
		cd db;
		wget "http://iweb.dl.sourceforge.net/project/bigdata/bigdata/1.5.3/bigdata-bundled.jar";
		cd ..;
		read -r -p "Do you want to backup the blazegraph client in ../db ? [Y/N] " response
		case $response in
		    [yY][eE][sS]|[yY])d
			mkdir ../db
			cp db/bigdata-bundled.jar ../db/bigdata-bundled.jar
			;;*)
		esac
	fi
fi

if ! find data-dev.sqlite | read v; then
	echo Setting up SQL server
	./manage.py db upgrade &> /dev/null
fi

echo finished
#echo """$ export MAIL_USERNAME='your-gmail-username'"""
#echo """$ export MAIL_PASSWORD='your-gmail-password'"""
echo """$ ./manage.py runserver"""
echo to run the server
#echo """you must not be behind a proxy"""